<div class="page-header">
  <button class="back-btn" (click)="goBack()">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="15 18 9 12 15 6"/>
    </svg>
  </button>
  <div>
    <h1>Intake &amp; Admission Form</h1>
    <p class="subtitle">Complete the client's intake details</p>
  </div>
</div>

<div class="save-banner" *ngIf="submitted">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
    <polyline points="20 6 9 17 4 12"/>
  </svg>
  Intake submitted — returning to dashboard…
</div>

<form #f="ngForm" (ngSubmit)="submit(f)" novalidate>

  <section class="card">
    <h2>Personal Details</h2>

    <div class="grid-2">
      <div class="form-field" [class.has-error]="fullName.invalid && fullName.touched">
        <label>Client Full Name *</label>
        <input name="fullName" #fullName="ngModel" [(ngModel)]="model.fullName"
          required placeholder="Enter full name" />
        <span class="field-error" *ngIf="fullName.invalid && fullName.touched">Full name is required</span>
      </div>

      <div class="form-field" [class.has-error]="age.invalid && age.touched">
        <label>Age *</label>
        <input type="number" name="age" #age="ngModel" [(ngModel)]="model.age"
          required min="1" max="120" placeholder="Age" />
        <span class="field-error" *ngIf="age.errors?.['required'] && age.touched">Age is required</span>
        <span class="field-error" *ngIf="(age.errors?.['min'] || age.errors?.['max']) && age.touched">Enter a valid age (1–120)</span>
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field" [class.has-error]="sex.invalid && sex.touched">
        <label>Sex *</label>
        <select name="sex" #sex="ngModel" [(ngModel)]="model.sex" required>
          <option value="">Select</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
        <span class="field-error" *ngIf="sex.invalid && sex.touched">Please select a sex</span>
      </div>

      <div class="form-field" [class.has-error]="phone.invalid && phone.touched">
        <label>Phone Number *</label>
        <input name="phone" #phone="ngModel" [(ngModel)]="model.phone"
          required [pattern]="phonePattern"
          placeholder="+254 700 000 000" />
        <span class="field-error" *ngIf="phone.errors?.['required'] && phone.touched">Phone number is required</span>
        <span class="field-error" *ngIf="phone.errors?.['pattern'] && phone.touched">Enter a valid phone number (digits, +, spaces, dashes)</span>
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field" [class.has-error]="emergency.invalid && emergency.touched">
        <label>Emergency Contact</label>
        <input name="emergency" #emergency="ngModel" [(ngModel)]="model.emergencyContact"
          [pattern]="phonePattern"
          placeholder="+254 700 000 000" />
        <span class="field-error" *ngIf="emergency.errors?.['pattern'] && emergency.touched">Enter a valid phone number</span>
      </div>

      <div class="form-field">
        <label>Nationality</label>
        <input name="nationality" [(ngModel)]="model.nationality" placeholder="Nationality" />
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field">
        <label>Marital Status</label>
        <select name="maritalStatus" [(ngModel)]="model.maritalStatus">
          <option value="">Select</option>
          <option>Single</option><option>Married</option>
          <option>Divorced</option><option>Widowed</option>
        </select>
      </div>

      <div class="form-field">
        <label>Religion</label>
        <select name="religion" [(ngModel)]="model.religion">
          <option value="">Select</option>
          <option>Christian</option><option>Muslim</option><option>Other</option>
        </select>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>Background &amp; Admission</h2>

    <div class="grid-2">
      <div class="form-field" [class.has-error]="admCat.invalid && admCat.touched">
        <label>Admission Category *</label>
        <select name="admissionCategory" #admCat="ngModel" [(ngModel)]="model.admissionCategory" required>
          <option value="">Select</option>
          <option>Sex Worker</option>
          <option>Drug User</option>
          <option>MSM</option>
          <option>Other</option>
        </select>
        <span class="field-error" *ngIf="admCat.invalid && admCat.touched">Admission category is required</span>
      </div>

      <div class="form-field">
        <label>Target Group</label>
        <select name="targetGroup" [(ngModel)]="model.targetGroup">
          <option value="">Select</option>
          <option>Female SW</option>
          <option>Male SW</option>
          <option>PWID</option>
          <option>MSM</option>
        </select>
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field">
        <label>Place of Origin</label>
        <input name="placeOfOrigin" [(ngModel)]="model.placeOfOrigin" placeholder="City or region" />
      </div>
      <div class="form-field">
        <label>Education Level</label>
        <input name="educationLevel" [(ngModel)]="model.educationLevel" placeholder="Highest education level" />
      </div>
    </div>
  </section>

  <div class="form-actions">
    <button class="secondary-btn" type="button" (click)="goBack()">Cancel</button>
    <button class="primary-btn submit-btn" type="submit" [disabled]="submitted">
      <svg *ngIf="!submitted" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
      {{ submitted ? 'Submitting…' : 'Submit Intake' }}
    </button>
  </div>

</form>
