<div class="page-header">
  <button class="back-btn" (click)="goBack()">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="15 18 9 12 15 6"/>
    </svg>
  </button>
  <div>
    <h1>Intake &amp; Admission Form</h1>
    <p class="subtitle">Complete the client's intake details</p>
  </div>
</div>

<div class="save-banner" *ngIf="submitted">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
    <polyline points="20 6 9 17 4 12"/>
  </svg>
  Intake submitted — returning to dashboard…
</div>

<form #f="ngForm" (ngSubmit)="submit(f)" novalidate>

  <section class="card">
    <h2>Personal Details</h2>
    <hr class="section-divider" />
    <p class="section-desc">Enter the client's basic personal information so we can identify them.</p>

    <div class="grid-2">
      <div class="form-field" [class.has-error]="fullName.invalid && fullName.touched">
        <label>Client Full Name *</label>
        <input name="fullName" #fullName="ngModel" [(ngModel)]="model.fullName"
          required placeholder="Enter full name" />
        <span class="field-error" *ngIf="fullName.invalid && fullName.touched">Full name is required</span>
      </div>

      <div class="form-field" [class.has-error]="age.invalid && age.touched">
        <label>Age *</label>
        <input type="number" name="age" #age="ngModel" [(ngModel)]="model.age"
          required min="1" max="120" placeholder="Age" />
        <span class="field-error" *ngIf="age.errors?.['required'] && age.touched">Age is required</span>
        <span class="field-error" *ngIf="(age.errors?.['min'] || age.errors?.['max']) && age.touched">Enter a valid age (1–120)</span>
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field" [class.has-error]="sex.invalid && sex.touched">
        <label>Sex *</label>
        <select name="sex" #sex="ngModel" [(ngModel)]="model.sex" required>
          <option value="">Select</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
        <span class="field-error" *ngIf="sex.invalid && sex.touched">Please select a sex</span>
      </div>

      <div class="form-field" [class.has-error]="phone.invalid && phone.touched">
        <label>Phone Number *</label>
        <input name="phone" #phone="ngModel" [(ngModel)]="model.phone"
          required [pattern]="phonePattern"
          placeholder="+254 700 000 000" />
        <span class="field-error" *ngIf="phone.errors?.['required'] && phone.touched">Phone number is required</span>
        <span class="field-error" *ngIf="phone.errors?.['pattern'] && phone.touched">Enter a valid phone number (digits, +, spaces, dashes)</span>
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field" [class.has-error]="emergency.invalid && emergency.touched">
        <label>Emergency Contact</label>
        <input name="emergency" #emergency="ngModel" [(ngModel)]="model.emergencyContact"
          [pattern]="phonePattern"
          placeholder="+254 700 000 000" />
        <span class="field-error" *ngIf="emergency.errors?.['pattern'] && emergency.touched">Enter a valid phone number</span>
      </div>

      <div class="form-field">
        <label>Nationality</label>
        <input name="nationality" [(ngModel)]="model.nationality" placeholder="Nationality" />
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field">
        <label>Marital Status</label>
        <select name="maritalStatus" [(ngModel)]="model.maritalStatus">
          <option value="">Select</option>
          <option>Single</option><option>Married</option>
          <option>Divorced</option><option>Widowed</option>
        </select>
      </div>

      <div class="form-field">
        <label>Religion</label>
        <select name="religion" [(ngModel)]="model.religion">
          <option value="">Select</option>
          <option>Christian</option><option>Muslim</option><option>Other</option>
        </select>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>Background &amp; Admission</h2>
    <hr class="section-divider" />
    <p class="section-desc">Record the client's admission category and any relevant background details.</p>

    <div class="grid-2">
      <div class="form-field" [class.has-error]="admCat.invalid && admCat.touched">
        <label>Admission Category *</label>
        <select name="admissionCategory" #admCat="ngModel" [(ngModel)]="model.admissionCategory" required>
          <option value="">Select</option>
          <option>Sex Worker</option>
          <option>Drug User</option>
          <option>MSM</option>
          <option>Other</option>
        </select>
        <span class="field-error" *ngIf="admCat.invalid && admCat.touched">Admission category is required</span>
      </div>

      <div class="form-field">
        <label>Target Group</label>
        <select name="targetGroup" [(ngModel)]="model.targetGroup">
          <option value="">Select</option>
          <option>Female SW</option>
          <option>Male SW</option>
          <option>PWID</option>
          <option>MSM</option>
        </select>
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field">
        <label>Place of Origin</label>
        <input name="placeOfOrigin" [(ngModel)]="model.placeOfOrigin" placeholder="City or region" />
      </div>
      <div class="form-field">
        <label>Education Level</label>
        <input name="educationLevel" [(ngModel)]="model.educationLevel" placeholder="Highest education level" />
      </div>
    </div>

    <div class="grid-2">
      <div class="form-field">
        <label>Cohort</label>
        <input name="cohort" [(ngModel)]="model.cohort" placeholder="e.g. March 2026" />
      </div>
      <div class="form-field">
        <label>Dorm Number</label>
        <input name="dormNumber" [(ngModel)]="model.dormNumber" placeholder="Dorm number" />
      </div>
    </div>

    <div class="form-field">
      <label>Tiko Card Number</label>
      <input name="tikoCard" [(ngModel)]="model.tikoCardNumber" placeholder="Tiko card number" />
    </div>
  </section>

  <!-- Health & Additional Info -->
  <section class="card">
    <h2>Health &amp; Additional Info</h2>
    <hr class="section-divider" />
    <p class="section-desc">Provide any health-related information and other useful notes.</p>
    <div class="grid-2">
      <div class="form-field">
        <label>Has Children?</label>
        <select name="hasChildren" [(ngModel)]="model.hasChildren">
          <option value="">Select</option>
          <option>Yes</option><option>No</option>
        </select>
      </div>
      <div class="form-field">
        <label>Physical Disabilities</label>
        <textarea name="physicalDisabilities" [(ngModel)]="model.physicalDisabilities" rows="4" placeholder="Describe any disabilities"></textarea>
      </div>
    </div>
    <div class="grid-2">
      <div class="form-field">
        <label>Health Issues</label>
        <textarea name="healthIssues" [(ngModel)]="model.healthIssues" rows="4" placeholder="List health issues"></textarea>
      </div>
      <div class="form-field">
        <label>Unique Talents</label>
        <textarea name="uniqueTalents" [(ngModel)]="model.uniqueTalents" rows="4" placeholder="Any talents?"></textarea>
      </div>
    </div>
  </section>







  <!-- Family Background & Expectations -->
  <section class="card">
    <h2>Family Background &amp; Expectations</h2>
    <hr class="section-divider" />
    <p class="section-desc">Tell us about the client's family history and their goals after the program.</p>
    <div class="form-field">
      <label>Family Background</label>
      <textarea name="familyBackground" [(ngModel)]="model.familyBackground" rows="3" placeholder="Brief family history..."></textarea>
    </div>
    <div class="form-field">
      <label>Expectations After Program</label>
      <textarea name="expectationsAfterProgram" [(ngModel)]="model.expectationsAfterProgram" rows="3" placeholder="Client's goals and expectations..."></textarea>
    </div>
  </section>

  <!-- Next step: Planning -->
  <section class="card">
    <h2>Next step: Planning</h2>
    <hr class="section-divider" />
    <p class="section-desc">Please select a planning date so we can automatically remind you when it's time to follow up with this client.</p>
    <div class="form-field">
      <label>Planning date</label>
      <input type="date" name="planningDate" [(ngModel)]="model.planningDate" />
    </div>
  </section>

  <!-- Re-Assign Case Manager -->
  <section class="card">
    <h2>Re-Assign Case Manager</h2>
    <hr class="section-divider" />
    <p class="section-desc">Currently assigned Case Manager for {{ model.fullName || 'this client' }} is Alexa Brown, if you want to change the Case Manager please select one from the dropdown form.</p>
    <div class="form-field">
      <label>Case Manager</label>
      <select name="reassignedManager" [(ngModel)]="model.reassignedManager">
        <option value="">Select Case Manager</option>
        <option *ngFor="let m of caseManagers" [value]="m">{{ m }}</option>
      </select>
    </div>
  </section>

  <div class="form-actions">
    <button class="secondary-btn" type="button" (click)="goBack()">Leave form</button>
    <button class="primary-btn submit-btn" type="submit" [disabled]="submitted">
      <svg *ngIf="!submitted" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
      {{ submitted ? 'Submitting…' : 'Submit Form' }}
    </button>
  </div>

</form>
